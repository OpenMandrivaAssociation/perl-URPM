diff --git a/URPM.pm b/URPM.pm
index a5a2ec9..e62a1b4 100644
--- a/URPM.pm
+++ b/URPM.pm
@@ -32,10 +32,10 @@ sub set_nofatal {
 
 sub packages_providing {
     my ($urpm, $name) = @_;
-#    grep { $_ } map { $urpm->{depslist}[$_] } keys %{$urpm->{provides}{$name} || {}};
+    grep { $_ } map { $urpm->{depslist}[$_] } keys %{$urpm->{provides}{$name} || {}};
     # NOTE: there was a comment indicating that there might be side effects in dependency solving;
     # however, this patch is used in ROSA Desktop Fresh and doesn't seem to lead to any issues
-    grep { $_ } map { $urpm->{depslist}[$_] } sort { $a <=> $b } keys %{$urpm->{provides}{$name} || {}};
+#    grep { $_ } map { $urpm->{depslist}[$_] } sort { $a <=> $b } keys %{$urpm->{provides}{$name} || {}};
 }
 
 sub packages_obsoleting {
diff --git a/URPM/Resolve.pm b/URPM/Resolve.pm
index dc3be2c..7553116 100644
--- a/URPM/Resolve.pm
+++ b/URPM/Resolve.pm
@@ -72,7 +72,7 @@ sub removed_or_obsoleted_packages {
 #-
 #- side-effects: none
 sub find_candidate_packages {
-    my ($urpm, $id_prop, $o_rejected) = @_;
+    my ($urpm, $db, $id_prop, $o_rejected) = @_;
     my @packages;
 
     foreach (split /\|/, $id_prop // '') {
@@ -89,7 +89,7 @@ sub find_candidate_packages {
 
                 # Do not select packages if newer version of it is already installed
                 my $should_select = 1;
-                my $db->traverse_tag('name', [ $pkg->name ], sub {
+                $db->traverse_tag('name', [ $pkg->name ], sub {
                     my ($p) = @_;
                     if( URPM::rpmEVRcompare($p->EVR, $pkg->EVR) > 0 ) {
                         $should_select = 0;
diff --git a/t/resolve.t b/t/resolve.t
index 12aa121..98c42b7 100644
--- a/t/resolve.t
+++ b/t/resolve.t
@@ -19,7 +19,7 @@ sub _find_candidate_packages {
     my ($urpm, $id_prop, $o_rejected) = @_;
 
     my %packages;
-    foreach ($urpm->find_candidate_packages($id_prop, $o_rejected)) {
+    foreach ($urpm->find_candidate_packages($db, $id_prop, $o_rejected)) {
 	push @{$packages{$_->name}}, $_;
     }
     \%packages;
